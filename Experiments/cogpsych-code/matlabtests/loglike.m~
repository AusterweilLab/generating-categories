function ll = loglike(parms,model,data_k, data_total, stim)
%Take in the model+parms and data generate predictions. 
%Then spit out the binomial likelihood for
%each element in prediction array. DATA_K should be a vector of the
%observed counts, and DATA_TOTAL should be a vector (of the same size)
%representing total counts
%STIM is a cell where 
% STIM{1} is an index of stimuli to test
% STIM{2} is the indices of trained stimuli arranged as an array where each row is a condition
% STIM{3} is an array indicating the categories of stimulis specified in STIM{2} 
% STIM{4} is the coordinates of all stimuli in the stimuli space
% STIM{5} is the task required (i.e., 'assign','generate', or 'error')

%Unpack stim 
stimTestIdx = stim{1};
stimTrainIdx = stim{2};
categoriesSet = stim{3};
stimCoords = stim{4};
task = stim{5};

nconditions = size(stimTrainIdx,2);

stimTest = stimCoords(stimTestIdx,:);

preds = zeros(nconditions,
for i = 1:nconditions
    stimTrain = stimCoords(stimTrainIdx,:);
    categories = categoriesSet(:,i)';
    preds = model(parms,stimTest,stimTrain,categories,task);
end


%Using matlab function
ll = binopdf(data_k,data_total,preds);

